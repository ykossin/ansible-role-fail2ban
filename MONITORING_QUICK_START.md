# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ fail2ban

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ä–æ–ª–∏

### 1. –ü—Ä–æ—Å—Ç—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å
/usr/local/bin/fail2ban-status.sh

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ jail
/usr/local/bin/fail2ban-status.sh sshd
```

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
```bash
# –û—Ç—á–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
/usr/local/bin/fail2ban-report.sh

# –û—Ç—á–µ—Ç –Ω–∞ email
/usr/local/bin/fail2ban-report.sh admin@example.com
```

#### –≠–∫—Å–ø–æ—Ä—Ç –≤ Prometheus
```bash
# –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
/usr/local/bin/fail2ban-prometheus.sh
```

---

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: Prometheus –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–î–ª—è —á–µ–≥–æ:** –ì—Ä–∞—Ñ–∏–∫–∏, –∏—Å—Ç–æ—Ä–∏—è, –∞–ª–µ—Ä—Ç—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```yaml
fail2ban_prometheus_enabled: true
fail2ban_prometheus_metrics_dir: "/var/lib/prometheus/node-exporter"
```

**–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ:**
- –ú–µ—Ç—Ä–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ node_exporter (textfile collector)
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ Grafana

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω node_exporter —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º textfile collector
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Prometheus + Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

**–î–ª—è —á–µ–≥–æ:** –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–≤–æ–¥–∫–∏ –æ —Ä–∞–±–æ—Ç–µ fail2ban

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```yaml
fail2ban_report_enabled: true
fail2ban_report_email: "admin@example.com"  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

**–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ:**
- –û—Ç—á–µ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 8:00 —É—Ç—Ä–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º jail
- –°–ø–∏—Å–æ–∫ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π MTA (sendmail/postfix) –¥–ª—è email

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—É–∂–µ –µ—Å—Ç—å)

**–î–ª—è —á–µ–≥–æ:** –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –±–∞–Ω–µ

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```yaml
fail2ban_config:
  destemail: "admin@example.com"
fail2ban_send_email: true
```

**–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ:**
- Email –ø—Ä–∏ –∫–∞–∂–¥–æ–º –±–∞–Ω–µ IP
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–±–∞–Ω–µ–Ω–Ω–æ–º IP

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

**–î–ª—è —á–µ–≥–æ:** –ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π

**–ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –õ–æ–≥–∏ –≤ `/var/log/fail2ban.log`
- –õ–æ–≥–∏ –≤ systemd journal: `journalctl -u fail2ban`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/fail2ban.log

# –ü–æ–∏—Å–∫ –±–∞–Ω–æ–≤
grep "Ban" /var/log/fail2ban.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å
grep "$(date +%Y-%m-%d)" /var/log/fail2ban.log | grep "Ban" | wc -l
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Ä—É—á–Ω—É—é
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
/usr/local/bin/fail2ban-status.sh

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ jail
/usr/local/bin/fail2ban-status.sh sshd
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç –≤ —Ñ–∞–π–ª
/usr/local/bin/fail2ban-report.sh > /tmp/fail2ban-report.txt

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ email
/usr/local/bin/fail2ban-report.sh admin@example.com
```

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä—É—á–Ω—É—é
/usr/local/bin/fail2ban-prometheus.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
cat /var/lib/prometheus/node-exporter/fail2ban.prom
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å Prometheus:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ node_exporter –∑–∞–ø—É—â–µ–Ω —Å `--collector.textfile.directory=/var/lib/prometheus/node-exporter`
2. –í–∫–ª—é—á–∏—Ç–µ Prometheus —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ä–æ–ª–∏
3. –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è Prometheus
4. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ Grafana

### –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å Telegram –±–æ—Ç:

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å action –¥–ª—è fail2ban, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram —á–µ—Ä–µ–∑ –≤–∞—à exchanger-bot API.

### –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π HTTP endpoint, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å fail2ban –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–ª—è –Ω–∞—á–∞–ª–∞:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
2. –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å MTA)

**–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. –í–∫–ª—é—á–∏—Ç–µ Prometheus —ç–∫—Å–ø–æ—Ä—Ç
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
3. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ Grafana

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –°–º. `MONITORING_OPTIONS.md` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
