---
# Переменные по умолчанию для роли fail2ban
# Обновлено: январь 2026

# Включить установку и настройку fail2ban
fail2ban_enabled: true

# Состояние fail2ban (started/stopped)
fail2ban_state: started

# Включить fail2ban при загрузке
fail2ban_enabled_on_boot: true

# Настройки по умолчанию для jail.local
fail2ban_config:
  # Логи и действия
  logtarget: "/var/log/fail2ban.log"
  loglevel: "INFO"
  syslogsocket: "auto"
  
  # Backend для мониторинга файлов
  # auto - автоматический выбор (рекомендуется)
  # systemd - для systemd-based систем
  # pyinotify - для старых систем без systemd
  backend: "auto"
  
  # Настройки бана
  bantime: 3600  # Время бана в секундах (1 час)
  findtime: 600  # Окно времени для поиска неудачных попыток (10 минут)
  maxretry: 5    # Количество неудачных попыток до бана
  
  # Настройки действия
  banaction: "ufw"  # ufw, iptables, iptables-multiport, iptables-allports
  action: "action_"
  
  # Настройки для iptables (если используется)
  chain: "INPUT"  # Цепочка iptables
  
  # Rate limiting (опционально)
  rate_limit: 10  # Максимум действий в секунду
  rate_limit_interval: 1  # Интервал в секундах
  
  # Email уведомления (опционально)
  destemail: ""
  sendername: "Fail2Ban"
  sender: "fail2ban@localhost"
  mta: "sendmail"
  
  # Настройки SSH
  ssh_port: "22"
  ssh_protocol: "tcp"
  
  # Поддержка IPv6
  ipv6_enabled: true

# Включенные jail (сервисы для защиты)
fail2ban_jails:
  - name: "sshd"
    enabled: true
    port: "ssh"
    filter: "sshd"
    logpath: "/var/log/auth.log"
    maxretry: 5
    bantime: 3600
    findtime: 600
  
  # Дополнительные jail (отключены по умолчанию)
  # Раскомментируйте и настройте при необходимости
  
  # - name: "nginx-http-auth"
  #   enabled: false
  #   port: "http,https"
  #   filter: "nginx-http-auth"
  #   logpath: "/var/log/nginx/error.log"
  #   maxretry: 3
  #   bantime: 3600
  #   findtime: 600
  
  # - name: "nginx-limit-req"
  #   enabled: false
  #   port: "http,https"
  #   filter: "nginx-limit-req"
  #   logpath: "/var/log/nginx/error.log"
  #   maxretry: 10
  #   bantime: 3600
  #   findtime: 600
  
  # - name: "apache-auth"
  #   enabled: false
  #   port: "http,https"
  #   filter: "apache-auth"
  #   logpath: "/var/log/apache2/*error.log"
  #   maxretry: 3
  #   bantime: 3600
  #   findtime: 600
  
  # - name: "postfix"
  #   enabled: false
  #   port: "smtp,465,submission"
  #   filter: "postfix"
  #   logpath: "/var/log/mail.log"
  #   maxretry: 3
  #   bantime: 3600
  #   findtime: 600
  
  # - name: "dovecot"
  #   enabled: false
  #   port: "pop3,pop3s,imap,imaps,submission,465,sieve"
  #   filter: "dovecot"
  #   logpath: "/var/log/mail.log"
  #   maxretry: 5
  #   bantime: 3600
  #   findtime: 600
  
  # - name: "recidive"
  #   enabled: false
  #   port: "all"
  #   filter: "recidive"
  #   logpath: "/var/log/fail2ban.log"
  #   maxretry: 5
  #   bantime: 604800  # 1 неделя
  #   findtime: 86400  # 1 день

# Белый список IP адресов (никогда не банить)
fail2ban_whitelist_ips: []
  # Примеры:
  # - "127.0.0.1/8"
  # - "::1"
  # - "10.0.0.0/8"
  # - "192.168.0.0/16"

# IP адреса для игнорирования (игнорировать попытки)
fail2ban_ignore_ips: []
  # Примеры:
  # - "127.0.0.1/8"
  # - "::1"

# Пользовательские фильтры
fail2ban_filters: []
  # Примеры:
  # - name: "custom-ssh"
  #   content: |
  #     [Definition]
  #     failregex = ^.*Failed password.*from <HOST>
  #     ignoreregex =

# Пользовательские действия
fail2ban_actions: []
  # Примеры:
  # - name: "custom-action"
  #   content: |
  #     [Definition]
  #     actionstart = ...
  #     actionstop = ...
  #     actioncheck = ...
  #     actionban = ...
  #     actionunban = ...

# Отправить email при бане (требует настройки email)
fail2ban_send_email: false

# Отправить email только при ошибках
fail2ban_email_only_errors: false

# Создавать директории для логов автоматически (если не существуют)
fail2ban_create_log_dirs: false

# Логировать действия роли в отдельный файл
fail2ban_log_actions: false
fail2ban_actions_log_path: "/var/log/ansible-fail2ban.log"

# Собирать метрики и статистику
fail2ban_collect_metrics: false

# Мониторинг
# Включить экспорт метрик в Prometheus (через node_exporter textfile collector)
fail2ban_prometheus_enabled: false
fail2ban_prometheus_metrics_dir: "/var/lib/prometheus/node-exporter"

# Включить ежедневные отчеты
fail2ban_report_enabled: false
fail2ban_report_email: ""  # Email для отправки отчетов (если пусто, только в stdout)
